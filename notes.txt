# Redmine Clone - Status Notes


## Letzte Iteration (2026-01-12)
- **DRY: FormFieldError Komponente erstellt**
  - Neue UI-Komponente in `src/components/ui/form-field-error.tsx`
  - Kapselt das wiederkehrende Pattern: `{error && <p><AlertCircle/>{error}</p>}`
  - 7 Form-Komponenten refaktoriert:
    - `src/app/admin/users/new/user-form.tsx` (4 Stellen)
    - `src/app/admin/users/[id]/edit/user-edit-form.tsx` (4 Stellen)
    - `src/app/issues/new/issue-form.tsx` (3 Stellen)
    - `src/app/issues/[id]/edit/issue-edit-form.tsx` (3 Stellen)
    - `src/app/time/new/time-entry-form.tsx` (4 Stellen)
    - `src/app/projects/new/project-form.tsx` (3 Stellen)
    - `src/app/projects/[identifier]/edit/project-edit-form.tsx` (3 Stellen)
  - **24 identische JSX-Blöcke → 1 wiederverwendbare Komponente**
  - ~120 Zeilen duplizierter Code entfernt (5 Zeilen × 24 = 120, Ersatz: 18 Zeilen)
  - Guard-Clause (`if (!error) return null`) vereinfacht Consumer-Code

## Vorherige Iteration (2026-01-12)
- **DRY: useFormField() Custom Hook erstellt**
  - Neuer Hook in `src/hooks/useFormField.ts` - kapselt das Pattern "Update Field + Clear Error"
  - 5 Form-Komponenten refaktoriert:
    - `src/app/admin/users/new/user-form.tsx`
    - `src/app/admin/users/[id]/edit/user-edit-form.tsx`
    - `src/app/issues/new/issue-form.tsx`
    - `src/app/issues/[id]/edit/issue-edit-form.tsx`
    - `src/app/time/new/time-entry-form.tsx`
  - 2 Projekt-Forms bewusst ausgelassen (haben spezielle Logik: Auto-Generate Identifier)
  - ~60 Zeilen duplizierter Code entfernt
  - TypeScript Generics für Type Safety

## Vorherige Iteration (2026-01-12)
- **DRY: getFullName() konsistent genutzt**
  - 7 Stellen mit direkter `{firstName} {lastName}` Konkatenation durch `getFullName()` ersetzt
  - Dateien:
    - `src/app/issues/new/issue-form.tsx`
    - `src/app/issues/[id]/edit/issue-edit-form.tsx`
    - `src/app/issues/[id]/issue-detail.tsx` (2 Stellen: assignee + author)
    - `src/app/issues/[id]/comments.tsx`
    - `src/app/issues/issues-list.tsx`
    - `src/app/projects/[identifier]/project-detail.tsx`
  - Vorteile: Single Source of Truth, einfacher Format-Änderung, Type Safety

## Vorherige Iteration (2026-01-12)
- **DRY: Form Options zentralisiert**
  - `trackerOptions`, `priorityOptions`, `projectStatusOptions` in `src/types/index.ts`
  - Aus Labels abgeleitet (Single Source of Truth)
  - 4 lokale Duplikate entfernt aus:
    - `src/app/issues/new/issue-form.tsx`
    - `src/app/issues/[id]/edit/issue-edit-form.tsx`
    - `src/app/projects/new/project-form.tsx`
    - `src/app/projects/[identifier]/edit/project-edit-form.tsx`
  - ~42 Zeilen duplizierter Code entfernt
  - Types (`IssueTracker`, `IssuePriority`, `ProjectStatus`) werden nun zentral importiert

## Vorherige Iteration (2026-01-12)
- **DRY: getFullName() generisch gemacht**
  - Zentrale Funktion in `src/types/index.ts` nun mit `{ firstName: string; lastName: string }` statt `User`
  - 3 lokale Duplikate entfernt aus:
    - `src/app/time/time-list.tsx`
    - `src/app/admin/users/users-list.tsx`
    - `src/components/dashboard/issues-table.tsx`
  - ~12 Zeilen Code entfernt, TypeScript Structural Typing ermöglicht Kompatibilität

## Vorherige Iteration (2026-01-12)
- **UX-Bugs behoben:**
  - Reports-Link aus Quick Actions entfernt (führte zu 404 - `/reports` existiert nicht)
  - "New Issue" Button in Sidebar verlinkt (war zuvor nicht klickbar)
  - Hardcoded "Recent Projects" aus Sidebar entfernt (zeigte fake Projekte die nicht existieren)

## Vorherige Iterationen
- **DRY: Server Action Error Handler zentralisiert** (14 catch-Blöcke, ~70 -> ~25 Zeilen)
- **DRY: formatDate() Utility zentralisiert** (7 Dateien, ~40 Zeilen)
- **DRY: TrackerIcon Komponente zentralisiert** (2 Dateien)
- **DRY: Ungenutzte SortDirection Re-Exports entfernt** (4 lib Dateien)
- **DRY: SortDirection in time-list.tsx** (lokale Definition entfernt)
- **DRY: Enum-Arrays zentralisiert** (`allIssueStatuses`, etc. in types/index.ts)
- **DRY: `SortIcon` Komponente zentralisiert** (3 Dateien, ~30 Zeilen)
- **DRY: `getInitials()` zentralisiert** (7 Dateien, ~50 Zeilen)
- **DRY: Label-Konstanten zentralisiert** (statusLabels, trackerLabels, etc.)
- **Markdown Rendering:** Issue-Beschreibungen und Kommentare
- **Performance:** `issues-list.tsx` - `toIssue()` Mapping in separates `useMemo`
- **Dark Mode:** System-Präferenz + Persistenz
- **Lesbarkeit/DRY:** toggle-Funktionen konsolidiert
- README.md projektspezifisch aktualisiert
- Test Coverage: **98.56%** (weit über Ziel 35%)

## PRD-Tasks Status:
- [x] Test Coverage auf 35% -> **98.56% erreicht!**
- [x] Dokumentation verbessern -> README.md aktualisiert
- [x] Code Quality / SortDirection DRY -> vollständig zentralisiert
- [x] Bug hunt (1 Code Smell gefixed: unsicherer Type Cast)
- [x] Lesbarkeit: toggle-Funktionen DRY gemacht
- [x] Performance-Optimierungen -> useMemo für toIssue() separiert
- [x] Design optimieren (Dark mode) -> System-Präferenz + Persistenz
- [x] Markdown in Issues rendern
- [x] Kommentare löschbar
- [x] DRY: getInitials() zentralisiert
- [x] DRY: TrackerIcon zentralisiert
- [x] DRY: formatDate() zentralisiert
- [x] DRY: Server Action Error Handler zentralisiert
- [x] UX: Broken Links und nicht-funktionale Buttons behoben
- [x] DRY: getFullName() generisch gemacht
- [x] DRY: Form Options zentralisiert (tracker, priority, projectStatus)
- [x] DRY: getFullName() konsistent genutzt (4 Stellen)
- [x] DRY: FormFieldError Komponente erstellt (24 Stellen)

## Bekannte TODOs im Code
- `src/app/time/new/time-entry-form.tsx:106` - Get actual user ID from auth context
- `src/app/issues/new/issue-form.tsx:119` - Get from auth context
(Diese sind architekturelle Platzhalter für Auth-System, kein Bug)

## Weitere DRY-Kandidaten (identifiziert, noch nicht umgesetzt)
- Server Action revalidatePath: Wiederholende Calls (geringer Nutzen)
- Unique-Check Functions: `isIdentifierTaken` / `isEmailTaken` ähnlich (nur 2 Stellen, unter 3er-Schwelle)
- ~~`updateField` Hook: 7 Form-Komponenten~~ → ✅ Erledigt! `useFormField()` Hook erstellt
- ~~`<FormFieldError>` Komponente: Error-Rendering Pattern (24 Stellen)~~ → ✅ Erledigt! `FormFieldError` Komponente erstellt
- `roleOptions` mit Icons: 2 Dateien (user-form, user-edit-form) - Icons sind UI-spezifisch, daher nicht in types/
- `SerializedUser/Project/Issue` Types: Viele ähnliche Definitionen (je ~3-8 Felder unterschiedlich pro Kontext)

## Nächste Schritte
- Auth vollständig implementieren
- UX verbessern
- Administration (Settings) Implementieren

---
Letzte Aktualisierung: 2026-01-12 (FormFieldError DRY-Refactoring)
